var mainApp=angular.module("mainApp",["ngRoute","ngToast","ui.bootstrap","nvd3","ui.grid","ui.grid.edit","ui.grid.grouping","ui.grid.exporter","ui.grid.pinning","angularSpinner"]);mainApp.config(["$routeProvider",function(a){a.when("/main",{templateUrl:"pages/main/main.html",controller:"mainController"}).when("/users",{templateUrl:"pages/user/users.html",controller:"usersController"}).when("/users/:id",{templateUrl:"pages/user/usersdetail.html",controller:"usersDetailController"}).when("/criaruser",{templateUrl:"pages/user/criaruser.html",controller:"criarUserController"}).when("/tarefas",{templateUrl:"pages/tarefas/tarefas.html",controller:"tarefasController"}).when("/recursos",{templateUrl:"pages/recursos/recursos.html",controller:"recursosController"}).when("/criarrecursos",{templateUrl:"pages/recursos/criarrecurso.html",controller:"criarRecursosController"}).when("/recursos/:id",{templateUrl:"pages/recursos/recursosdetail.html",controller:"recursosDetailController"}).when("/recursos/:id/tarefa/:tarefa",{templateUrl:"pages/tarefas/tarefasdetail.html",controller:"tarefasDetailController"}).when("/recursos/:id/novatarefa",{templateUrl:"pages/tarefas/tarefasdetail.html",controller:"tarefasDetailController"}).when("/projectos",{templateUrl:"pages/projectos/projectos.html",controller:"projectosController"}).when("/criarprojecto",{templateUrl:"pages/projectos/projectodetail.html",controller:"projectosDetailController"}).when("/projectos/:id",{templateUrl:"pages/projectos/projectodetail.html",controller:"projectosDetailController"}).when("/backlog",{templateUrl:"pages/backlog/backlog.html",controller:"backlogController"}).when("/oportunidades",{templateUrl:"pages/oportunidades/oportunidades.html",controller:"oportunidadeController"}).when("/criaroportunidade",{templateUrl:"pages/oportunidades/oportunidadedetail.html",controller:"oportunidadeDetailController"}).when("/oportunidades/:id",{templateUrl:"pages/oportunidades/oportunidadedetail.html",controller:"oportunidadeDetailController"}).when("/budget",{templateUrl:"pages/budget/budget.html",controller:"budgetController"}).when("/login",{templateUrl:"pages/users/login.html"}).otherwise({redirectTo:"/main"})}]),mainApp.config(["ngToastProvider",function(a){a.configure({verticalPosition:"top",horizontalPosition:"right",maxNumber:3,timeout:2e3,dismissOnTimeout:!0})}]),mainApp.controller("navController",["$scope",function(a){a.funcao1="Utilizadores",a.funcao2="Backlog",a.funcao3="Recursos",a.funcao4="Projectos",a.funcao5="Budget"}]),mainApp.controller("backlogController",["$scope","BacklogServices","uiGridGroupingConstants","uiGridConstants","BudgetServices","ModalServices","FileServices","ngToast",function(a,b,c,d,e,f,g,h){var i=["Partner","Associate Partner","Senior Manager","Manager","Senior Consultant","Consultant","Analyst"],j=function(a,b){var c=i.indexOf(a.nivel),d=i.indexOf(b.nivel);return c-d};a.meses=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],a.anos=["2015","2016","2017"];var k=new Date,l=k.getMonth(),m=k.getFullYear().toString();a.backlogData={},a.backlogData.mes=a.meses[l],a.backlogData.ano=m,a.gridOptions={showColumnFooter:!0,enableSorting:!1,columnDefs:[{field:"nivel",headerCellClass:"blue",width:150,pinnedLeft:!0,grouping:{groupPriority:0}},{field:"recurso",headerCellClass:"blue",width:150,pinnedLeft:!0,enableFilter:!0},{field:"horas",headerCellClass:"blue",width:70,pinnedLeft:!0,cellClass:function(a,b,c,d,e){var f=a.getCellValue(b,c);return void 0!=f?a.getCellValue(b,c)>100?"green":"red":void 0}},{field:"rate",headerCellClass:"blue",width:70}],enableGridMenu:!0,exporterCsvFilename:"myFile.csv",exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location"))},a.getPeriodo=function(){var b=a.meses.indexOf(a.backlogData.mes)+1;return 10>b&&(b="0"+b),a.backlogData.ano.concat(b)},b.getBacklogColumnDefs().then(function(b){for(var d=0;d<b.length;d++)b[d].displayName=b[d].field,b[d].projectId=b[d].projectId,b[d].width=120,b[d].displayName=b[d].field,b[d].headerCellClass="blue",b[d].enableCellEdit=!0,b[d].treeAggregationType=c.aggregation.sum,b[d].footerCellTemplate='<div class="ui-grid-cell-contents">{{grid.appScope.'+b[d].field+"}} €</div>",a.gridOptions.columnDefs.push(b[d])}),a.gridOptions.onRegisterApi=function(c){a.gridApi=c,a.msg={};var e={};c.edit.on.afterCellEdit(a,function(f,g,h,i){b.updateProjecto(g.projectId,h,a.getPeriodo(),f.recursoid);var j=h-i;f.horas=f.horas+j,e[f.$$hashKey]=e[f.$$hashKey]||[],e[f.$$hashKey].push("horas".split(".")[0]),f.changed=e,c.core.notifyDataChange(d.dataChange.COLUMN),a.$apply(),a.actualizarTotais(),a.budgetData.percentagem=a.getPercentagem()})},a.actualizarTotais=function(){a.gridOptions.columnDefs.forEach(function(b,c){a[b.field]=0,"nivel"!=b.field&&"horas"!=b.field&&"rate"!=b.field&&"recurso"!=b.field&&a.gridOptions.data.forEach(function(c,d){a[b.field]=a[b.field]+c[b.field]*c.rate})})},a.getPercentagem=function(){var b=0;return a.gridOptions.columnDefs.forEach(function(c,d){"nivel"!=c.field&&"horas"!=c.field&&"rate"!=c.field&&"recurso"!=c.field&&a.gridOptions.data.forEach(function(a,d){b+=a[c.field]*a.rate})}),a.budgetData?Math.round(b/a.budgetData.valor*100):0},a.uploadBacklog=function(){var c=event.target.files[0],d="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";if(c.type.match(d)){var e=new FileReader;e.onload=function(c){var d=g.XLSXToArray(e.result);a.spin.close();var i=b.processFile(d);f.popUpToConfirm("Confirmar o carregamento?").result.then(function(){b.updateBacklog(a.getPeriodo(),i).then(function(){b.getBacklogData(a.getPeriodo()).then(function(b){a.gridOptions.data=b.sort(j),a.actualizarTotais(),a.budgetData&&(a.budgetData.percentagem=a.getPercentagem()),h.create("Carregado com sucesso")})})})},a.spin=f.showSpinner(),a.spin.opened.then(function(){e.readAsBinaryString(c)})}else a.textoLido="File not supported!"},e.getBudgetForId(a.getPeriodo(),function(b){a.budgetData={},b.valor?(a.budgetData.valor=b.valor,a.budgetData.horas=b.horas):(a.budgetData.valor=0,a.budgetData.horas=0)},function(a){}),b.getBacklogData(a.getPeriodo()).then(function(b){a.gridOptions.data=b.sort(j),a.actualizarTotais(),a.budgetData&&(a.budgetData.percentagem=a.getPercentagem())}),a.mesSelected=function(c){a.backlogData.mes=c,b.getBacklogData(a.getPeriodo()).then(function(b){a.gridOptions.data=b.sort(j),a.actualizarTotais(),a.budgetData.percentagem=a.getPercentagem()})},a.anoSelected=function(c){a.backlogData.ano=c,b.getBacklogData(a.getPeriodo(),function(b){a.gridOptions.data=b.sort(j),a.actualizarTotais(),a.budgetData.percentagem=a.getPercentagem()})}}]),mainApp.controller("budgetController",["$scope","BudgetServices",function(a,b){a.meses=["Janeiro","Fevereiro","Marco","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],a.anos=["2015","2016","2017"],a.gridOptions={showColumnFooter:!0,enableSorting:!1,columnDefs:[{field:"periodo",headerCellClass:"blue",width:150,pinnedLeft:!0},{field:"valor",headerCellClass:"blue",width:150,pinnedLeft:!0},{field:"horas",headerCellClass:"blue",width:150,pinnedLeft:!0}]},a.gridOptions.onRegisterApi=function(c){a.gridApi=c,a.msg={},c.edit.on.afterCellEdit(a,function(c,d,e,f){c._id?b.updateBudget(c._id,c,function(){}):b.createBudget(c,function(a){c._id=a._id}),a.$apply()})},b.getAllBudgets(function(b){var c=[{periodo:"201501",valor:0,horas:0},{periodo:"201501",valor:0,horas:0},{periodo:"201502",valor:0,horas:0},{periodo:"201503",valor:0,horas:0},{periodo:"201504",valor:0,horas:0},{periodo:"201505",valor:0,horas:0},{periodo:"201506",valor:0,horas:0},{periodo:"201507",valor:0,horas:0},{periodo:"201508",valor:0,horas:0},{periodo:"201509",valor:0,horas:0},{periodo:"201510",valor:0,horas:0},{periodo:"201511",valor:0,horas:0},{periodo:"201512",valor:0,horas:0},{periodo:"201601",valor:0,horas:0},{periodo:"201602",valor:0,horas:0},{periodo:"201603",valor:0,horas:0},{periodo:"201604",valor:0,horas:0},{periodo:"201605",valor:0,horas:0},{periodo:"201606",valor:0,horas:0},{periodo:"201607",valor:0,horas:0},{periodo:"201608",valor:0,horas:0}];c.forEach(function(a){b.forEach(function(b){a.periodo==b.periodo&&(a.valor=b.valor,a.horas=b.horas,a._id=b._id)})}),a.gridOptions.data=c},function(a){})}]),mainApp.controller("mainController",["$scope","$http","ProjectoServices","EmployeeServices",function(a,b,c,d){var e=["#9ACD66","#18d3ff","#00A1DE","#72C7E7","#3C8A2E","#BDD203"],f=[{key:"Alocado",y:0},{key:"Livre",y:0}];a.pieOptions={chart:{color:e,type:"pieChart",height:350,x:function(a){return a.key},y:function(a){return a.y},showLabels:!0,labelThreshold:.01,legend:{margin:{top:5,right:35,bottom:5,left:0},padding:{left:10,right:10}}}},a.barOptions={chart:{color:e,type:"discreteBarChart",height:350,margin:{top:20,right:20,bottom:60,left:55},x:function(a){return a.key},y:function(a){return a.y},showValues:!0,transitionDuration:500,xAxis:{axisLabel:"Projecto"},yAxis:{axisLabel:"Nº recursos",axisLabelDistance:30}}},a.pieOptionsFee={chart:{color:e,type:"pieChart",height:350,x:function(a){return a.codigo},y:function(a){return a.valor},showLabels:!1,labelThreshold:.01,legend:{margin:{top:5,right:35,bottom:5,left:0},padding:{left:10,right:10}}}},a.barOptions2={chart:{color:e,type:"discreteBarChart",height:350,margin:{top:20,right:20,bottom:60,left:55},x:function(a){return a.codigo},y:function(a){return a.valor},showValues:!0,transitionDuration:500,xAxis:{axisLabel:"Projecto"},yAxis:{axisLabel:"Nº recursos",axisLabelDistance:30}}};var g=function(b,c,d,e){for(var g=0;g<b.length;g++)"Sim"===b[g].tem.tarefa?f[0].y=f[0].y+1:f[1].y=f[1].y+1;a.data=f};b.get("/recursos/recursos").success(g).error(function(a,b,c,d){});var h=function(a,b){for(var c=0;c<b.length;c++)if(b[c].key==a)return b[c];return void 0};b.get("/recursos/tarefas").success(function(b){for(var c,d=[],e=0;e<b.length;e++)c=h(b[e].projecto,d),c?c.y=c.y+1:(c={},c.key=b[e].projecto,c.y=1,d.push(c));a.data2=[{key:"Cumulative",values:d}]}).error(function(a){}),d.getAllEmployees().then(c.getNetFeesForEmpregados).then(function(b){var c,d=new Date,e=d.getMonth()+1,f=d.getFullYear();a.periodo=f+"/"+e,c=10>e?f+"0"+e:f+e;var g=b[c];if(g){var h=g.projectos;a.feeProj=$.map(h,function(a,b){return[a]}),a.feeProj2=[{key:"Cumulative",values:a.feeProj}]}else a.feeProj=[],a.feeProj2=[{key:"Cumulative",values:a.feeProj}]})}]),mainApp.controller("oportunidadeController",["$scope","$modal","OportunidadeServices","$filter",function(a,b,c,d){a.filtro={},a.filtro.estado="Aberto";var e=function(){a.t25=0,a.t50=0,a.t75=0,a.t100=0,a.oportunidades.forEach(function(b){b.p25=0,b.p50=0,b.p75=0,b.p100=0,b.probabilidade<25?(b.p25=b.p25+b.valor,a.t25=a.t25+b.valor):b.probabilidade<50?(b.p50=b.p50+b.valor,a.t50=a.t50+b.valor):b.probabilidade<75?(b.p75=b.p75+b.valor,a.t75=a.t75+b.valor):(b.p100=b.p100+b.valor,a.t100=a.t100+b.valor)})};c.getAllOportunidades().then(function(b){a.oportunidades=b,e()}),a.sortCliente=function(){a.oportunidades=d("orderBy")(a.oportunidades,"cliente")},a.sortDescritivo=function(){a.oportunidades=d("orderBy")(a.oportunidades,"descritivo")},a.soAbertosChanged=function(){a.filtro||(a.filtro={}),a.mostraFechados?a.filtro.estado=void 0:a.filtro.estado="Aberto"}}]),mainApp.controller("oportunidadeDetailController",["$scope","$routeParams","OportunidadeServices","$location",function(a,b,c,d){a.estados=["Aberto","Fechado"],b.id?(a.titulo="Detalhe de oportunidade",c.getOportunidadeForId(b.id).then(function(b){a.opData=b})):(a.titulo="Criar oportunidade",a.opData={},a.opData.estado="Aberto"),a.estadoSelected=function(b){a.opData.estado=b},a.gravar=function(){b.id?c.updateOportunidade(b.id,a.opData).then(function(){d.path("/oportunidades/")}):c.createOportunidade(a.opData).then(function(){d.path("/oportunidades/")})}}]),mainApp.controller("projectosController",["$scope","$modal","ProjectoServices",function(a,b,c){c.getAllProjectos().then(function(b){a.projectos=b})}]),mainApp.controller("projectosDetailController",["$scope","$routeParams","ProjectoServices","$location",function(a,b,c,d){a.estados=["Aberto","Fechado"],b.id?(a.titulo="Detalhe de projecto",c.getProjectoForId(b.id).then(function(b){a.projData=b,a.projData.dataInicio=new Date(a.projData.dataInicio),a.projData.dataFim=new Date(a.projData.dataFim)})):(a.titulo="Criar projecto",a.projData={},a.projData.estado="Aberto"),a.estadoSelected=function(b){a.projData.estado=b},a.gravar=function(){b.id?c.updateProjecto(b.id,a.projData).then(function(){d.path("/projectos/")}):c.createProjecto(a.projData).then(function(){d.path("/projectos/")})}}]);var niveis=["Partner","Associate Partner","Senior Manager","Manager","Senior Consultant","Consultant","Analyst"];mainApp.controller("recursosController",["$scope","$filter","EmployeeServices","FileServices","ModalServices","ngToast",function(a,b,c,d,e,f){c.getAllEmployees().then(function(b){a.empregados=b}),a.sortNome=function(){a.empregados=b("orderBy")(a.empregados,"name")},a.sortNivel=function(){a.empregados=b("orderBy")(a.empregados,"nivel")},a.soLivresChanged=function(){a.filtro||(a.filtro={}),a.filtro.tarefa={},a.soLivres?a.filtro.tarefa.actual="!":a.filtro.tarefa.actual=void 0},a.uploadFile=function(b){var g=b.target.files[0],h=/text.*/,i="application/vnd.ms-excel",j="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";if(g.type.match(h)||g.type.match(i)){var k=new FileReader;k.onload=function(a){var b;b=d.CSVToArray(k.result);var f=c.recursosFromArray(b);e.showFileValidation(f).result.result.then(function(){return c.updateFromArray(f.$scope.empregados)})},k.readAsText(g)}else if(g.type.match(j)){var k=new FileReader;k.onload=function(b){var g=d.XLSXToArray(k.result);a.spin.close(),d.isListaRecursosValid(g)?e.showFileValidation(g).result.then(function(){return c.updateFromArray(g,a.empregados)}).then(function(a){f.success("Users actualizados")}):f.danger("Usar template correcto")},a.spin=e.showSpinner(),a.spin.opened.then(function(){k.readAsBinaryString(g)})}else a.textoLido="File not supported!"},a.sendMail=function(){c.sendRecursosMail().then(function(a){f.create("Enviado com sucesso")},function(a){f.danger("Erro no envio")})},a.downloadFile=function(){c.downloadFile("listaRecursos.xlsx").then(function(a){})}}]),mainApp.controller("recursosDetailController",["$scope","$routeParams","ngToast","$location","EmployeeServices",function(a,b,c,d,e){a.niveis=niveis,e.getEmployeeForId(b.id).then(function(b){a.empData=b}),a.gravar=function(){a.modificarForm.$valid&&e.updateEmployee(b.id,a.empData).then(function(a){d.path("/recursos")})},a.adicionar=function(){d.path("/recursos/"+b.id+"/novatarefa")},a.navegarTarefa=function(a){d.path("/recursos/"+b.id+"/tarefa/"+a._id)}}]),mainApp.controller("criarRecursosController",["$scope","ngToast","$location","EmployeeServices",function(a,b,c,d){a.empData={},a.empData.nivel="Escolher nível",a.niveis=niveis,a.gravar=function(){a.criarForm.$valid&&"Escolher nível"!=a.empData.nivel?d.createEmployee(a.empData).then(function(){c.path("/recursos")}):b.create("Escolher nível")},a.dropSelected=function(b){a.empData.nivel=b}}]),mainApp.controller("tarefasDetailController",["$scope","$routeParams","ngToast","$location","EmployeeServices","ProjectoServices",function(a,b,c,d,e,f){var g=["Aberta","Fechada"];f.getAllProjectos().then(function(b){var c=[];c.push("Non-chargable");for(var d=0;d<b.length;d++)c.push(b[d].codigo);a.projectos=c}),a.estados=g,a.tarefaData={},b.tarefa?(a.titulo="Detalhe tarefa",e.getEmployeeForId(b.id).then(function(c){for(var d=0;d<c.tarefas.length;d++){var e=c.tarefas[d];e._id==b.tarefa&&(a.tarefaData=e,a.tarefaData.dataInicio=new Date(a.tarefaData.dataInicio),a.tarefaData.dataFim=new Date(a.tarefaData.dataFim))}})):(a.tarefaData={},a.titulo="Criar tarefa",a.tarefaData.dataInicio=new Date,a.tarefaData.projecto="Escolher projecto"),a.tarefaData.status||(a.tarefaData.status="Aberta"),a.dropSelected=function(b){a.tarefaData.projecto=b},a.estadoSelected=function(b){a.tarefaData.status=b},a.gravar=function(){b.tarefa?e.updateTarefaForEmployee(b.id,a.tarefaData).then(function(){d.path("/recursos/"+b.id)}):e.createTarefaForEmployee(b.id,a.tarefaData).then(function(){d.path("/recursos/"+b.id)})}}]),mainApp.controller("usersController",["$scope","UserServices","$q","ModalServices",function(a,b,c,d){b.getAllUsers().then(function(b){a.users=b},function(a){});var e=function(c){return b.deleteUser(a.selected._id)},f=function(){var b=a.users.indexOf(a.selected);b>-1&&a.users.splice(b,1)};a.requestDeleteSelected=function(b){a.selected=b;var c=d.popUpToConfirm("Deseja apagar este utilizador?");c.result.then(e).then(f)}}]),mainApp.controller("usersDetailController",["$scope","$routeParams","ngToast","UserServices","$location",function(a,b,c,d,e){d.getUserForId(b.id).then(function(b){b?a.userData=b:e.path("/users/")},function(a){}),a.gravar=function(){a.modificarForm.$valid&&d.updateUser(b.id,a.userData).then(function(a){c.create("Gravado com sucesso")},function(a){})}}]),mainApp.controller("criarUserController",["$scope","$routeParams","ngToast","UserServices",function(a,b,c,d){a.gravar=function(){a.criarForm.$valid&&(a.userData.password==a.confirmPass?d.createUser(a.userData).then(function(){c.create("Gravado com sucesso")},function(a){}):c.danger("Passwords não são identicas"))}}]),mainApp.service("BacklogServices",["ProjectoServices","EmployeeServices","$http",function(a,b,c){var d=function(a,b,c){for(var d=0;d<a.horas.length;d++){var e=a.horas[d];if(e.recursoId==b&&e.periodo==c)return e}return void 0};this.getBacklogColumnDefs=function(){var b=[];return a.getAllProjectos().then(function(a){for(var c=0;c<a.length;c++)b.push({headerName:a[c].name,field:a[c].codigo,projectId:a[c]._id});return b})},this.getBacklogData=function(c){var e,f=[];return a.getAllProjectos().then(function(a){var g=a;return b.getAllEmployees().then(function(a){for(var b=0;b<a.length;b++){e={nivel:a[b].nivel,recurso:a[b].name,rate:a[b].rateHora,recursoid:a[b]._id,horas:0};for(var h=0;h<g.length;h++){var i=g[h],j=d(g[h],a[b]._id,c);j?(e[i.codigo]=j.numero,e.horas=e.horas+j.numero):e[i.codigo]=0}f.push(e)}return f})}).then(function(a){return a})},this.updateProjecto=function(b,c,e,f){var g=function(){},h=function(){};a.getProjectoForId(b).then(function(b){var i=d(b,f,e);i?i.numero=c:(i={},i.recursoId=f,i.numero=c,i.periodo=e,b.horas.push(i)),a.updateProjecto(b._id,b,g,h)})};var e=function(a){var b=a.match(/^(\d{1,2})-(\d{1,2})-(\d{4})$/);return b?b[3]+b[2]:null},f=function(a,b,c){var d;return c.forEach(function(c){c.recursoCodigo==a&&c.periodo==b&&(d=c)}),d};this.processFile=function(a){var b=Object.keys(a[0]),c=[],d={},g={};return b.forEach(function(a,b){var f=e(a);f?d[a]=f:c.push(b)}),b.splice(0,c.length),a.forEach(function(a){var c=g[a["Engagement Number"]];c||(c={},g[a["Engagement Number"]]=c,c.codigo=a["Engagement Number"],c.horas=[]),b.forEach(function(b){if(0!=a[b]){var e=f(a["Staff Number"],d[b],c.horas);e||(e={},e.valor=0,c.horas.push(e)),e.periodo=d[b],e.valor=e.valor+parseInt(a[b],10),e.recursoCodigo=a["Staff Number"]}})}),g},this.updateBacklog=function(a,b){return c.post("/projectos/backlog/"+a,b,{}).then(function(a){return a.data})}}]),mainApp.service("BudgetServices",["$http",function(a){this.getAllBudgets=function(b,c){a.get("/budget/").success(b).error(c)},this.getBudgetForId=function(b,c,d){a.get("/budget/"+b).success(c).error(d)},this.createBudget=function(b,c,d){a.post("/budget/create/",b,{}).success(c).error(d)},this.updateBudget=function(b,c,d,e){a.put("/budget/"+b,c,{}).success(d).error(e)},this.deleteBudget=function(b,c,d){a["delete"]("/budget/"+b,{}).success(c).error(d)}}]),mainApp.service("FileServices",[function(){this.CSVToArray=function(a,b){b=b||";";for(var c=new RegExp("(\\"+b+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+b+"\\r\\n]*))","gi"),d=[[]],e=null;e=c.exec(a);){var f=e[1];f.length&&f!==b&&d.push([]);var g;g=e[2]?e[2].replace(new RegExp('""',"g"),'"'):e[3],d[d.length-1].push(g)}return d},this.XLSXToArray=function(a){var b=XLSX.read(a,{type:"binary"}),c=[];return b.SheetNames.forEach(function(a){var d=XLSX.utils.sheet_to_row_object_array(b.Sheets[a]);d.length>0&&c.push(d)}),c[0]},this.isListaRecursosValid=function(a){var b=a[0];if(b){var c=Object.keys(b),d=c.indexOf("codigo"),e=c.indexOf("rateHora"),f=c.indexOf("nome"),g=c.indexOf("nivel");return!(-1==d||-1==e||-1==f||-1==g)}return!1}}]),mainApp.service("ModalServices",["$modal",function(a){this.showSpinner=function(){return a.open({animation:!0,templateUrl:"/modals/spinner.html",controller:"spinnerController",size:"m",backdrop:"static",keyboard:"false"})},this.showFileValidation=function(b){return a.open({animation:!0,templateUrl:"/modals/confirmFile.html",controller:"confirmFileController",size:"l",resolve:{elements:function(){return b}}})},this.popUpToConfirm=function(b){return a.open({animation:!0,templateUrl:"/modals/popToConfirm.html",controller:"popToConfirmController",size:"sm",resolve:{texto:function(){return b}}})}}]),mainApp.service("OportunidadeServices",["$http",function(a){this.getAllOportunidades=function(b,c){return a.get("/oportunidades/").then(function(a){return a.data})},this.getOportunidadeForId=function(b,c,d){return a.get("/oportunidades/"+b).then(function(a){return a.data})},this.createOportunidade=function(b,c,d){return a.post("/oportunidades/create",b,{}).then(function(a){return a.data})},this.updateOportunidade=function(b,c,d,e){return a.put("/oportunidades/"+b,c,{}).then(function(a){return a.data})},this.deleteOportunidade=function(b,c,d){return a["delete"]("/oportunidades/"+b,{}).then(function(a){return a.data})}}]),mainApp.service("ProjectoServices",["$http",function(a){this.getAllProjectos=function(b,c){return a.get("/projectos/projectos").then(function(a){return a.data})},this.getProjectoForId=function(b,c,d){return a.get("/projectos/projectos/"+b).then(function(a){return a.data})},this.createProjecto=function(b,c,d){return a.post("/projectos/projectos",b,{}).then(function(a){return a.data})},this.updateProjecto=function(b,c,d,e){return a.put("/projectos/projectos/"+b,c,{}).then(function(a){return a.data})},this.deleteProjecto=function(b,c,d){return a["delete"]("/projectos/projectos/"+b,{}).then(function(a){return a.data})},this.getNetFeesForEmpregados=function(b){var c=[],d={};return b.forEach(function(a){d[a._id]=a}),a.get("/projectos/projectos").then(function(a){var b=a.data;return b.forEach(function(a){a.horas.forEach(function(b){var e=c[b.periodo];e||(e={},e.id=b.periodo,e.projectos={},c[e.id]=e);var f=d[b.recursoId];if(f){var g=e.projectos[a._id];g||(g={},g._id=a._id,g.codigo=a.codigo,g.valor=0,e.projectos[g._id]=g),g.valor=g.valor+b.numero*f.rateHora}})}),c})}}]),mainApp.service("EmployeeServices",["$http","$q",function(a,b){this.getAllEmployees=function(){return a.get("/recursos/recursos").then(function(a){return a.data})},this.getEmployeeForId=function(b){return a.get("/recursos/recursos/"+b).then(function(a){return a.data})},this.createEmployee=function(b){return a.post("/recursos/recursos/",b,{}).then(function(a){return a.data})},this.updateEmployee=function(b,c,d,e){return a.put("/recursos//recursos/"+b,c,{}).then(function(a){return a.data})};var c=this.updateEmployee,d=this.createEmployee;this.deleteEmployee=function(b,c,d){return a["delete"]("/recursos//recursos/"+b,{}).then(function(a){return a.data})},this.createTarefaForEmployee=function(b,c,d,e){return a.post("/recursos/recursos/"+b+"/tarefa",c,{}).then(function(a){return a.data})},this.updateTarefaForEmployee=function(b,c,d,e){return a.put("/recursos/recursos/"+b+"/tarefa/"+c._id,c,{}).then(function(a){return a.data})},this.recursosFromArray=function(a){var b,c=[];return a.forEach(function(a){b={},b.codigo=a[0],b.nome=a[1],b.rateHora=a[2],""!=b.codigo&&c.push(b)}),c},this.updateFromArray=function(a,b){var e=[],f=[];a.forEach(function(a){var c=!1;if(b.forEach(function(b){a.codigo==b.codigo&&(b.rateHora=a.rateHora,b.nivel=a.nivel,e.push(b),c=!0)}),!c){var d={};d.codigo=a.codigo,d.rateHora=a.rateHora,d.name=a.nome,d.nivel=a.nivel,f.push(d)}}),e.forEach(function(a){c(a._id,a)}),f.forEach(function(a){d(a)})},this.sendRecursosMail=function(){return a.get("/recursos/mailrecursos/",{}).then(function(a){return a.data},function(a){return b.reject(a)})},this.downloadFile=function(c){var d=b.defer();return a.get("/recursos/filerecursos/",{responseType:"arraybuffer"}).success(function(a,b,e){var f=e("Content-Type"),g=e("Content-Disposition");if(g){var h=g.match(/.*filename=\"?([^;\"]+)\"?.*/);h[1]&&(c=h[1])}c=c.replace(/[<>:"\/\\|?*]+/g,"_");var i=new Blob([a],{type:f});saveAs(i,c),d.resolve(c)}).error(function(a,b){var c=d.reject(c)}),d.promise}}]),mainApp.service("UserServices",["$http","$q",function(a,b){this.getAllUsers=function(){return a.get("/users/utilizadores").then(function(a){return a.data})},this.getUserForId=function(c){return a.get("/users/utilizadores/"+c).then(function(a){return a.data},function(a){b.reject(a.data)})},this.createUser=function(b){return a.post("/users/utilizadores",b,{}).then(function(a){return a.data})},this.updateUser=function(b,c){return a.put("/users/utilizadores/"+b,c,{}).then(function(a){return a.data})},this.deleteUser=function(b){return a["delete"]("/users/utilizadores/"+b,{}).then(function(a){return b})}}]),!function(a,b){"object"==typeof module&&module.exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return m[e]||(k.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",k.cssRules.length),m[e]=1),e}function d(a,b){var c,d,e=a.style;if(b=b.charAt(0).toUpperCase()+b.slice(1),void 0!==e[b])return b;for(d=0;d<l.length;d++)if(c=l[d]+b,void 0!==e[c])return c}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}k.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.scale*d.width,left:d.scale*d.radius,top:-d.scale*d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.scale*(d.length+d.width),k=2*d.scale*j,l=-(d.width+d.length)*d.scale*2+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k,l=["webkit","Moz","ms","O"],m={},n={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(h.defaults={},f(h.prototype,{spin:function(b){this.stop();var c=this,d=c.opts,f=c.el=a(null,{className:d.className});if(e(f,{position:d.position,width:0,zIndex:d.zIndex,left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function o(){h++;for(var a=0;a<d.lines;a++)g=Math.max(1-(h+(d.lines-a)*n)%l*m,d.opacity),c.opacity(f,a*d.direction+i,g,d);c.timeout=c.el&&setTimeout(o,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.scale*(f.length+f.width)+"px",height:f.scale*f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.scale*f.radius+"px,0)",borderRadius:(f.corners*f.scale*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.scale*f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}}),"undefined"!=typeof document){k=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}();var o=e(a("group"),{behavior:"url(#default#VML)"});!d(o,"transform")&&o.adj?i():j=d(o,"animation")}return h}),mainApp.controller("confirmFileController",["$scope","$modalInstance","elements",function(a,b,c){a.elements=c,a.element=a.elements[0],a.keys=Object.keys(a.element),a.ok=function(){b.close("ok")},a.cancel=function(){b.dismiss("cancel")}}]),mainApp.controller("popToConfirmController",["$scope","$modalInstance","texto",function(a,b,c){a.mensagem=c,a.ok=function(){b.close("ok")},a.cancel=function(){b.dismiss("cancel")}}]),mainApp.controller("spinnerController",["$scope","$modalInstance",function(a,b){a.cancel=function(){b.dismiss("cancel")}}]),mainApp.directive("inputOnChange",function(){return{restrict:"A",link:function(a,b,c){var d=a.$eval(c.inputOnChange);b.bind("change",d)}}}),mainApp.directive("fileTable",function(){return{restrict:"E",scope:{tableData:"=dados",keys:"=keys"},template:function(a,b){var c='<table class="table"><thead><tr><th ng-repeat="key in keys">{{key}}</th></tr></thead><tbody><tr ng-repeat="element in tableData"><td ng-repeat="key in keys">{{element[key]}}</td></tr></tbody></table>';return c}}}),mainApp.directive("loadingSpinner",function(){return{restrict:"A",replace:!0,transclude:!0,scope:{loading:"=loadingSpinner"},templateUrl:"directives/templates/loading.html",link:function(a,b,c){var d=(new Spinner).spin(),e=b.find(".loading-spinner-container")[0];e.appendChild(d.el)}}});